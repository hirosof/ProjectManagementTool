# プロジェクト管理ツール_実装方針確定メモ

本ドキュメントは、
公式仕様書「プロジェクト管理ツール_ClaudeCode仕様書.md」を前提として、
**実装技術・実装方針に関する確定判断**をまとめたものである。

本ファイルは **公式仕様そのものを変更・上書きしない**。
あくまで「実装時の迷いを排除するための確定メモ」として扱う。

---

## 1. 実装言語・フレームワーク（D1）

- 実装言語：**Python**
- UI：**TUI（textual）**
- 永続化：**SQLite**
  - Python 標準の `sqlite3` を使用

理由：
- 段階的実装・検証がしやすい
- TUI / dry-run / doctor/check 実装との相性が良い
- AI 実装支援（Claude Code）との親和性が高い

---

## 2. 表示順（手動制御）の実装方式（D2）

- 表示順は **order 整数カラム方式**を採用
- 並び替え対象は **同一親配下のみ**
- MVPではシンプル実装を優先し、必要に応じて最適化

---

## 3. SubProject 入れ子拡張余地の扱い（D3）

- DBには `parent_subproject_id` を持たせる
- **MVPでは入れ子操作・UIは提供しない**
- 実運用は 1 階層前提とする

目的：
- 将来の拡張時に破壊的マイグレーションを避けるため

---

## 4. 依存関係テーブル設計（D7）

- 依存関係は **2 テーブル方式**
  - `task_dependencies`
  - `subtask_dependencies`
- レイヤ跨ぎ依存は禁止（仕様準拠）

理由：
- DBレベルで混入事故を防止できる
- doctor/check の実装が単純になる

---

## 5. 削除操作の粒度（D6）

### 基本方針（安全側MVP）

- 子要素を持つノードの削除は **デフォルト禁止**
- 連鎖削除（配下ごと削除）は **明示フラグ付きの別操作**
- ノード削除時は **直接先行・直接後続を橋渡し再接続**
- 破壊的操作は **必ず dry-run（プレビュー）を提供**

---

## 6. doctor / check の検査範囲（D4）

### Error（整合性破壊）

- DAG 循環
- レイヤ跨ぎ依存
- 依存参照先欠損
- 親子関係参照先欠損

### Warning（不健全だが動作可能）

- ステータス矛盾
- 表示順（order）の重複・欠番

※ doctor/check は検出とレポートを主目的とし、自動修復は必須としない

---

## 7. UNSET ステータスの扱い（D5）

- UNSET は **ユーザーが手動で設定・解除可能**
- 意味：
  - 「未運用」
  - 「一時的な棚上げ」
- UNSET への遷移／UNSET からの遷移は制限しない
- DONE のみ、既存仕様どおり遷移条件チェックを行う

---

## 8. 位置づけと注意事項

- 本ファイルは **実装方針の確定記録**
- 公式仕様と矛盾しない前提でのみ有効
- 将来変更する場合は、本ファイルを更新する

---

（以上）
