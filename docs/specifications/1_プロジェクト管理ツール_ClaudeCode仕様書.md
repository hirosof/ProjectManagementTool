# プロジェクト管理ツール 仕様書（Claude Code 向け）

## 1. 目的
本仕様書は、個人利用を前提としたプロジェクト管理ツールについて、  
Claude Code にそのまま渡せる設計・仕様を定義するものである。

---

## 2. 全体方針

- 拡張性・保守性を最優先
- AIによる推測・自動補完を極力排除
- 実装は段階的（フェーズ分割）を許容

---

## 3. UI / 実行環境

- 初期UI：TUI（Text User Interface）
- 実行環境：ローカル
- 永続化方式：SQLite（単一DBファイル）

---

## 4. 構造モデル

### 4.1 階層

- Project
  - SubProject（フォルダ相当、将来入れ子拡張余地あり）
    - Task
      - SubTask

※ Task は Project 直下または SubProject 配下のいずれか一箇所にのみ所属可能

---

## 5. 依存関係（Finish-to-Start）

- Task ↔ Task（同一Project内のみ）
- SubTask ↔ SubTask（同一Task内のみ）
- レイヤ跨ぎ依存は禁止
- DAG制約（循環禁止）

### 削除時の挙動
- ノード削除時、直接先行と直接後続を橋渡し再接続する

---

## 6. ステータス管理

### ステータス種別
- UNSET
- NOT_STARTED
- IN_PROGRESS
- DONE

### 基本方針
- DONE 遷移のみ制御
- IN_PROGRESS への遷移は制限しない

### DONE 遷移条件
- 直接先行ノードがすべて DONE
- 親Taskは配下のSubTaskがすべて DONE

---

## 7. テンプレート

### 対象
- 基点以下一式をテンプレート化可能
- Task/SubTaskを含めない空構造テンプレも可（選択式）

### 適用方式
- スナップショット方式（複製・独立）
- 全ノード新ID
- 依存は内部写像で再接続
- 外部参照は存在しない前提

### ステータス
- 適用時に選択式
  - コピー
  - UNSET化
  - NOT_STARTED化

---

## 8. 並び順・命名

- 表示順はユーザーが手動制御可能
- 同一階層内で名前の重複は禁止

---

## 9. 非採用事項

- 自動ステータス巻き戻し
- DONE以外の遷移強制
- 曖昧な特例ルール

---

## 10. 実装上の注意

- 破壊的操作は必ずプレビュー（dry-run）を持つ
- doctor/check による整合性検査を提供
- DB制約とアプリ制約の責務を明確に分離
